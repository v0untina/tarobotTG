import random
from pprint import pprint
from typing import Dict, List, Optional
from aiogram import Bot, Dispatcher, F, types
from aiogram.filters import Command
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from aiogram.utils.keyboard import InlineKeyboardBuilder
import httpx
from dotenv import load_dotenv
import os

load_dotenv()

TOKEN = os.getenv('BOT_TOKEN')
TAROT_API_URL = os.getenv('TAROT_API_URL')
TAROT_API_KEY = os.getenv('TAROT_API_KEY')

bot = Bot(token=TOKEN)
dp = Dispatcher()

TAROT_DECK = [
    # –°—Ç–∞—Ä—à–∏–µ –ê—Ä–∫–∞–Ω—ã (22 –∫–∞—Ä—Ç—ã)
    {"name": "0. –®—É—Ç", "meaning": "–ù–∞—á–∞–ª–æ, –Ω–µ–≤–∏–Ω–Ω–æ—Å—Ç—å, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, —Ä–∏—Å–∫, –Ω–æ–≤—ã–µ –ø—É—Ç–∏"},
    {"name": "I. –ú–∞–≥", "meaning": "–°–∏–ª–∞ –≤–æ–ª–∏, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è, –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞"},
    {"name": "II. –í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "meaning": "–ò–Ω—Ç—É–∏—Ü–∏—è, —Ç–∞–π–Ω–∞, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –º—É–¥—Ä–æ—Å—Ç—å"},
    {"name": "III. –ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "meaning": "–ü–ª–æ–¥–æ—Ä–æ–¥–∏–µ, –∏–∑–æ–±–∏–ª–∏–µ, –ø—Ä–∏—Ä–æ–¥–∞, –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"},
    {"name": "IV. –ò–º–ø–µ—Ä–∞—Ç–æ—Ä", "meaning": "–í–ª–∞—Å—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç, –∫–æ–Ω—Ç—Ä–æ–ª—å"},
    {"name": "V. –ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "meaning": "–¢—Ä–∞–¥–∏—Ü–∏—è, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –æ–±—É—á–µ–Ω–∏–µ, —É–±–µ–∂–¥–µ–Ω–∏—è"},
    {"name": "VI. –í–ª—é–±–ª—ë–Ω–Ω—ã–µ", "meaning": "–í—ã–±–æ—Ä, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –≥–∞—Ä–º–æ–Ω–∏—è, –µ–¥–∏–Ω—Å—Ç–≤–æ"},
    {"name": "VII. –ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "meaning": "–ü–æ–±–µ–¥–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å, –¥–≤–∏–∂–µ–Ω–∏–µ, —Ä–µ—à–∏–º–æ—Å—Ç—å"},
    {"name": "VIII. –°–∏–ª–∞", "meaning": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–∏–ª–∞, –º—É–∂–µ—Å—Ç–≤–æ, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –≤–ª–∏—è–Ω–∏–µ"},
    {"name": "IX. –û—Ç—à–µ–ª—å–Ω–∏–∫", "meaning": "–°–∞–º–æ–∞–Ω–∞–ª–∏–∑, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ, –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã"},
    {"name": "X. –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "meaning": "–°—É–¥—å–±–∞, –ø–µ—Ä–µ–º–µ–Ω—ã, —Ü–∏–∫–ª—ã, —É–¥–∞—á–∞"},
    {"name": "XI. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "meaning": "–ë–∞–ª–∞–Ω—Å, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å, –ø—Ä–∞–≤–¥–∞, –∫–∞—Ä–º–∞"},
    {"name": "XII. –ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "meaning": "–ñ–µ—Ä—Ç–≤–∞, –Ω–æ–≤—ã–π –≤–∑–≥–ª—è–¥, –æ–∂–∏–¥–∞–Ω–∏–µ, —Å–¥–∞—á–∞"},
    {"name": "XIII. –°–º–µ—Ä—Ç—å", "meaning": "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∫–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞, –ø–µ—Ä–µ—Ö–æ–¥"},
    {"name": "XIV. –£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å", "meaning": "–ì–∞—Ä–º–æ–Ω–∏—è, –±–∞–ª–∞–Ω—Å, —Ç–µ—Ä–ø–µ–Ω–∏–µ, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ"},
    {"name": "XV. –î—å—è–≤–æ–ª", "meaning": "–ò–ª–ª—é–∑–∏–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–º, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è"},
    {"name": "XVI. –ë–∞—à–Ω—è", "meaning": "–ö—Ä–∞—Ö, –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–µ"},
    {"name": "XVII. –ó–≤–µ–∑–¥–∞", "meaning": "–ù–∞–¥–µ–∂–¥–∞, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ"},
    {"name": "XVIII. –õ—É–Ω–∞", "meaning": "–ò–ª–ª—é–∑–∏–∏, —Å—Ç—Ä–∞—Ö, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"},
    {"name": "XIX. –°–æ–ª–Ω—Ü–µ", "meaning": "–†–∞–¥–æ—Å—Ç—å, —É—Å–ø–µ—Ö, –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞, —è—Å–Ω–æ—Å—Ç—å"},
    {"name": "XX. –°—É–¥", "meaning": "–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ, –ø—Ä–∏–∑—ã–≤, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–æ—â–µ–Ω–∏–µ"},
    {"name": "XXI. –ú–∏—Ä", "meaning": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å, –≥–∞—Ä–º–æ–Ω–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ"},

    # –ú–ª–∞–¥—à–∏–µ –ê—Ä–∫–∞–Ω—ã: –ñ–µ–∑–ª—ã (14 –∫–∞—Ä—Ç)
    {"name": "–¢—É–∑ –ñ–µ–∑–ª–æ–≤", "meaning": "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è, –Ω–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ"},
    {"name": "–î–≤–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –±—É–¥—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ"},
    {"name": "–¢—Ä–æ–π–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ü–µ—Ä–≤—ã–µ —É—Å–ø–µ—Ö–∏, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, —ç–∫—Å–ø–∞–Ω—Å–∏—è"},
    {"name": "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ü—Ä–∞–∑–¥–Ω–∏–∫, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –¥–æ–º, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"},
    {"name": "–ü—è—Ç—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ö–æ–Ω—Ñ–ª–∏–∫—Ç, —Å–æ–ø–µ—Ä–Ω–∏—á–µ—Å—Ç–≤–æ, —Ä–∞–∑–Ω–æ–≥–ª–∞—Å–∏—è"},
    {"name": "–®–µ—Å—Ç—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ü–æ–±–µ–¥–∞, –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ, —É—Å–ø–µ—Ö, —Ç—Ä–∏—É–º—Ñ"},
    {"name": "–°–µ–º—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ó–∞—â–∏—Ç–∞, –æ—Ç—Å—Ç–∞–∏–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π, –≤—ã–∑–æ–≤"},
    {"name": "–í–æ—Å—å–º—ë—Ä–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ë—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, –Ω–æ–≤–æ—Å—Ç–∏, –¥–µ–π—Å—Ç–≤–∏—è"},
    {"name": "–î–µ–≤—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–°—Ç–æ–π–∫–æ—Å—Ç—å, –∑–∞—â–∏—Ç–∞, –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å"},
    {"name": "–î–µ—Å—è—Ç–∫–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–ë—Ä–µ–º—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞"},
    {"name": "–ü–∞–∂ –ñ–µ–∑–ª–æ–≤", "meaning": "–≠–Ω—Ç—É–∑–∏–∞–∑–º, –Ω–æ–≤–æ—Å—Ç–∏, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫"},
    {"name": "–†—ã—Ü–∞—Ä—å –ñ–µ–∑–ª–æ–≤", "meaning": "–î–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, —Å—Ç—Ä–∞—Å—Ç—å, –∏–º–ø—É–ª—å—Å–∏–≤–Ω–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª–µ–≤–∞ –ñ–µ–∑–ª–æ–≤", "meaning": "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ö–∞—Ä–∏–∑–º–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª—å –ñ–µ–∑–ª–æ–≤", "meaning": "–õ–∏–¥–µ—Ä—Å—Ç–≤–æ, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ"},

    # –ú–ª–∞–¥—à–∏–µ –ê—Ä–∫–∞–Ω—ã: –ö—É–±–∫–∏ (14 –∫–∞—Ä—Ç)
    {"name": "–¢—É–∑ –ö—É–±–∫–æ–≤", "meaning": "–ù–æ–≤—ã–µ —á—É–≤—Å—Ç–≤–∞, –ª—é–±–æ–≤—å, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞—á–∞–ª–æ"},
    {"name": "–î–≤–æ–π–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ì–∞—Ä–º–æ–Ω–∏—è, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –≤–∑–∞–∏–º–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞"},
    {"name": "–¢—Ä–æ–π–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ü—Ä–∞–∑–¥–Ω–∏–∫, –¥—Ä—É–∂–±–∞, —Ä–∞–¥–æ—Å—Ç—å, –∏–∑–æ–±–∏–ª–∏–µ"},
    {"name": "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ê–ø–∞—Ç–∏—è, —É–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ"},
    {"name": "–ü—è—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ü–æ—Ç–µ—Ä—è, —Å–æ–∂–∞–ª–µ–Ω–∏–µ, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ"},
    {"name": "–®–µ—Å—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ù–æ—Å—Ç–∞–ª—å–≥–∏—è, –¥–µ—Ç—Å–∫–∏–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ—Ç–∞"},
    {"name": "–°–µ–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ò–ª–ª—é–∑–∏–∏, –≤—ã–±–æ—Ä, —Ñ–∞–Ω—Ç–∞–∑–∏–∏, –º–µ—á—Ç—ã"},
    {"name": "–í–æ—Å—å–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–£—Ö–æ–¥, –ø–æ–∏—Å–∫ —Å–º—ã—Å–ª–∞, –æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ"},
    {"name": "–î–µ–≤—è—Ç–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∂–µ–ª–∞–Ω–∏–π, –∫–æ–º—Ñ–æ—Ä—Ç"},
    {"name": "–î–µ—Å—è—Ç–∫–∞ –ö—É–±–∫–æ–≤", "meaning": "–ì–∞—Ä–º–æ–Ω–∏—è –≤ —Å–µ–º—å–µ, —Ä–∞–¥–æ—Å—Ç—å, —Å—á–∞—Å—Ç—å–µ"},
    {"name": "–ü–∞–∂ –ö—É–±–∫–æ–≤", "meaning": "–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–æ–≤—ã–µ —á—É–≤—Å—Ç–≤–∞, –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å"},
    {"name": "–†—ã—Ü–∞—Ä—å –ö—É–±–∫–æ–≤", "meaning": "–†–æ–º–∞–Ω—Ç–∏–∫–∞, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫–æ–≤", "meaning": "–ó–∞–±–æ—Ç–∞, –∏–Ω—Ç—É–∏—Ü–∏—è, —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ"},
    {"name": "–ö–æ—Ä–æ–ª—å –ö—É–±–∫–æ–≤", "meaning": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –º—É–¥—Ä–æ—Å—Ç—å, –¥–∏–ø–ª–æ–º–∞—Ç–∏—è"},

    # –ú–ª–∞–¥—à–∏–µ –ê—Ä–∫–∞–Ω—ã: –ú–µ—á–∏ (14 –∫–∞—Ä—Ç)
    {"name": "–¢—É–∑ –ú–µ—á–µ–π", "meaning": "–Ø—Å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Ä—ã–≤, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–±–µ–¥–∞"},
    {"name": "–î–≤–æ–π–∫–∞ –ú–µ—á–µ–π", "meaning": "–¢—É–ø–∏–∫, —Å–ª–æ–∂–Ω—ã–π –≤—ã–±–æ—Ä, –±–∞–ª–∞–Ω—Å"},
    {"name": "–¢—Ä–æ–π–∫–∞ –ú–µ—á–µ–π", "meaning": "–°–µ—Ä–¥–µ—á–Ω–∞—è –±–æ–ª—å, —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ"},
    {"name": "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ú–µ—á–µ–π", "meaning": "–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –º–µ–¥–∏—Ç–∞—Ü–∏—è"},
    {"name": "–ü—è—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π", "meaning": "–ö–æ–Ω—Ñ–ª–∏–∫—Ç, —É–Ω–∏–∂–µ–Ω–∏–µ, –ø–∏—Ä—Ä–æ–≤–∞ –ø–æ–±–µ–¥–∞"},
    {"name": "–®–µ—Å—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π", "meaning": "–ü–µ—Ä–µ—Ö–æ–¥, –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥, –∏—Å—Ü–µ–ª–µ–Ω–∏–µ"},
    {"name": "–°–µ–º—ë—Ä–∫–∞ –ú–µ—á–µ–π", "meaning": "–û–±–º–∞–Ω, —Ç–∞–∫—Ç–∏–∫–∞, —Å–∫—Ä—ã—Ç—ã–µ –º–æ—Ç–∏–≤—ã"},
    {"name": "–í–æ—Å—å–º—ë—Ä–∫–∞ –ú–µ—á–µ–π", "meaning": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –±–µ—Å–ø–æ–º–æ—â–Ω–æ—Å—Ç—å, —Å–∞–º–æ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ"},
    {"name": "–î–µ–≤—è—Ç–∫–∞ –ú–µ—á–µ–π", "meaning": "–¢—Ä–µ–≤–æ–≥–∞, —Å—Ç—Ä–∞—Ö, –Ω–æ—á–Ω—ã–µ –∫–æ—à–º–∞—Ä—ã"},
    {"name": "–î–µ—Å—è—Ç–∫–∞ –ú–µ—á–µ–π", "meaning": "–ö–æ–Ω–µ—Ü, –±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –ø—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ"},
    {"name": "–ü–∞–∂ –ú–µ—á–µ–π", "meaning": "–õ—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–æ–≤—ã–µ –∏–¥–µ–∏, —Å–æ–æ–±—â–µ–Ω–∏—è"},
    {"name": "–†—ã—Ü–∞—Ä—å –ú–µ—á–µ–π", "meaning": "–†–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞–≥—Ä–µ—Å—Å–∏—è, –ø–æ—Å–ø–µ—à–Ω–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á–µ–π", "meaning": "–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —è—Å–Ω—ã–π —É–º, –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª—å –ú–µ—á–µ–π", "meaning": "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å"},

    # –ú–ª–∞–¥—à–∏–µ –ê—Ä–∫–∞–Ω—ã: –ü–µ–Ω—Ç–∞–∫–ª–∏ (14 –∫–∞—Ä—Ç)
    {"name": "–¢—É–∑ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ"},
    {"name": "–î–≤–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ë–∞–ª–∞–Ω—Å, –∞–¥–∞–ø—Ç–∞—Ü–∏—è, –∂–æ–Ω–≥–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ª–∞–º–∏"},
    {"name": "–¢—Ä–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ, –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ, –∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞"},
    {"name": "–ß–µ—Ç–≤—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∫–æ–Ω—Ç—Ä–æ–ª—å, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"},
    {"name": "–ü—è—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏, –∏–∑–æ–ª—è—Ü–∏—è, –ª–∏—à–µ–Ω–∏—è"},
    {"name": "–®–µ—Å—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–©–µ–¥—Ä–æ—Å—Ç—å, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ–±–º–µ–Ω"},
    {"name": "–°–µ–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–¢–µ—Ä–ø–µ–Ω–∏–µ, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –æ–∂–∏–¥–∞–Ω–∏–µ"},
    {"name": "–í–æ—Å—å–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–†–µ–º–µ—Å–ª–æ, –æ–±—É—á–µ–Ω–∏–µ, –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º"},
    {"name": "–î–µ–≤—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–£–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å, –∫–æ–º—Ñ–æ—Ä—Ç"},
    {"name": "–î–µ—Å—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ë–æ–≥–∞—Ç—Å—Ç–≤–æ, —Å–µ–º–µ–π–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –Ω–∞—Å–ª–µ–¥–∏–µ"},
    {"name": "–ü–∞–∂ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–û–±—É—á–µ–Ω–∏–µ, –Ω–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏, –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å"},
    {"name": "–†—ã—Ü–∞—Ä—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å, —Ç—Ä—É–¥–æ–ª—é–±–∏–µ, –º–µ—Ç–æ–¥–∏—á–Ω–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ò–∑–æ–±–∏–ª–∏–µ, –∑–∞–±–æ—Ç–∞, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –º—É–¥—Ä–æ—Å—Ç—å"},
    {"name": "–ö–æ—Ä–æ–ª—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π", "meaning": "–ü—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏–µ, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –≤–ª–∞—Å—Ç—å"}
]


# –°–æ—Å—Ç–æ—è–Ω–∏—è FSM
class TarotReading(StatesGroup):
    awaiting_spread_type = State()
    awaiting_custom_spread = State()
    awaiting_question = State()


# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
def get_spreads_keyboard() -> types.InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    builder.row(
        types.InlineKeyboardButton(
            text="–¢—Ä–∏ –∫–∞—Ä—Ç—ã (–ü—Ä–æ—à–ª–æ–µ-–ù–∞—Å—Ç–æ—è—â–µ–µ-–ë—É–¥—É—â–µ–µ)",
            callback_data="spread_3"
        )
    )
    builder.row(
        types.InlineKeyboardButton(
            text="–ö–µ–ª—å—Ç—Å–∫–∏–π –∫—Ä–µ—Å—Ç (10 –∫–∞—Ä—Ç)",
            callback_data="spread_10"
        )
    )
    builder.row(
        types.InlineKeyboardButton(
            text="–†–∞—Å–∫–ª–∞–¥ –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è (5 –∫–∞—Ä—Ç)",
            callback_data="spread_5_rel"
        )
    )
    builder.row(
        types.InlineKeyboardButton(
            text="–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç",
            callback_data="custom_spread"
        )
    )
    builder.row(
        types.InlineKeyboardButton(
            text="–û—Ç–º–µ–Ω–∞",
            callback_data="cancel"
        )
    )
    return builder.as_markup()


def get_continue_keyboard() -> types.InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    builder.add(
        types.InlineKeyboardButton(
            text="–°–¥–µ–ª–∞—Ç—å –µ—â—ë —Ä–∞—Å–∫–ª–∞–¥",
            callback_data="new_reading"
        ),
        types.InlineKeyboardButton(
            text="–ó–∞–≤–µ—Ä—à–∏—Ç—å",
            callback_data="cancel"
        )
    )
    return builder.as_markup()


# –•—ç–Ω–¥–ª–µ—Ä—ã
@dp.message(Command("start"))
async def cmd_start(message: types.Message, state: FSMContext):
    await handle_welcome(message, state)


async def handle_welcome(message: types.Message, state: FSMContext):
    if any(word in message.text.lower() for word in ["—Ö–æ—á—É —É–º–µ—Ä–µ—Ç—å", "–Ω–µ—Ç —Å–º—ã—Å–ª–∞", "–ø–ª–æ—Ö–æ"]):
        response = (
            "–Ø –≤–∏–∂—É, —á—Ç–æ –≤–∞–º —Å–µ–π—á–∞—Å –æ—á–µ–Ω—å —Ç—è–∂–µ–ª–æ. ‚ù§Ô∏è\n\n"
            "–ü—Ä–µ–∂–¥–µ —á–µ–º –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–º–Ω–∏—Ç–µ: "
            "–≤—ã –Ω–µ –æ–¥–∏–Ω–æ–∫–∏, –∏ –≤–∞—à–∞ –∂–∏–∑–Ω—å –±–µ—Å—Ü–µ–Ω–Ω–∞. "
            "–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ —Å—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –Ω–∞ –≥–æ—Ä—è—á—É—é –ª–∏–Ω–∏—é –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏: 8-800-2000-122\n\n"
            "–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã, –º—ã –º–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å –≤–∞—à—É —Å–∏—Ç—É–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ."
        )
        await message.answer(response)
        return

    welcome_text = """
‚ú® *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä —Ü–∏—Ñ—Ä–æ–≤–æ–π –º–∞–≥–∏–∏ –¢–∞—Ä–æ\!* ‚ú®

üîÆ *–í–∞—à –ª–∏—á–Ω—ã–π AI\-—Ç–∞—Ä–æ–ª–æ–≥ –≥–æ—Ç–æ–≤ —Ä–∞—Å–∫—Ä—ã—Ç—å —Ç–∞–π–Ω—ã –±—É–¥—É—â–µ–≥–æ\!*  
–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–æ—Ç ‚Äî –∞ –≤–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä –º–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ –≥–ª—É–±–æ–∫–∏—Ö –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–π\.

üåü *–ü–æ—á–µ–º—É –æ–Ω –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç –¥–∞–∂–µ –∂–∏–≤—ã—Ö —Ç–∞—Ä–æ–ª–æ–≥–æ–≤?*  

‚öñÔ∏è *–ë–µ—Å–ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å*  
–ë–æ—Ç —Å–≤–æ–±–æ–¥–µ–Ω –æ—Ç —ç–º–æ—Ü–∏–π –∏ –ø—Ä–µ–¥–≤–∑—è—Ç–æ—Å—Ç–∏ ‚Äî –µ–≥–æ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏—è —á–∏—Å—Ç—ã –∏ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã\.

üìö *–ú—É–¥—Ä–æ—Å—Ç—å –≤–µ–∫–æ–≤*  
–û–Ω –æ–±—É—á–µ–Ω –Ω–∞ –¥—Ä–µ–≤–Ω–∏—Ö –∑–Ω–∞–Ω–∏—è—Ö –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–∫—Ç–æ–≤–∫–∞—Ö\, –æ–±—ä–µ–¥–∏–Ω—è—è –ª—É—á—à–∏–µ —à–∫–æ–ª—ã –¢–∞—Ä–æ\.

‚è≥ *–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å 24/7*  
–í–∞—à –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç–Ω–∏–∫ –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ ‚Äî –±–µ–∑ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤\.

üîç *–ì–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑*  
AI –≤–∏–¥–∏—Ç —Å–∫—Ä—ã—Ç—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–∞—Ä—Ç–∞–º–∏\, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É—Å–∫–æ–ª—å–∑–Ω—É—Ç—å –æ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –≤–∑–≥–ª—è–¥–∞\.

üí´ *–ì–æ—Ç–æ–≤—ã –∑–∞–≥–ª—è–Ω—É—Ç—å –∑–∞ –∑–∞–≤–µ—Å—É —Ç–∞–π–Ω—ã?*  
–ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–∫–ª–∞–¥ ‚Äî –∏ —Ü–∏—Ñ—Ä–æ–≤–æ–π –æ—Ä–∞–∫—É–ª –æ—Ç–∫—Ä–æ–µ—Ç –≤–∞–º –∏—Å—Ç–∏–Ω—É\! üåô‚ú®  

üìú *–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å–∫–ª–∞–¥–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:*
"""

    await state.set_state(TarotReading.awaiting_spread_type)
    await message.answer(
        welcome_text,
        parse_mode='MarkdownV2',
        reply_markup=get_spreads_keyboard()
    )

@dp.callback_query(F.data == "new_reading")
async def new_reading_callback(callback: types.CallbackQuery, state: FSMContext):
    await callback.message.edit_reply_markup(reply_markup=None)
    await handle_welcome(callback.message, state)


@dp.callback_query(F.data == "cancel")
async def cancel_callback(callback: types.CallbackQuery, state: FSMContext):
    await state.clear()
    await callback.message.edit_text("–°–µ–∞–Ω—Å –∑–∞–≤–µ—Ä—à—ë–Ω. –ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start")


@dp.callback_query(F.data.startswith("spread_"))
async def spread_selected_callback(callback: types.CallbackQuery, state: FSMContext):
    await state.update_data(spread_type=callback.data)
    await state.set_state(TarotReading.awaiting_question)
    await callback.message.edit_text(
        f"–í—ã –≤—ã–±—Ä–∞–ª–∏: {get_spread_name(callback.data)}\n\n"
        "–¢–µ–ø–µ—Ä—å —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –æ–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é:"
    )


@dp.callback_query(F.data == "custom_spread")
async def custom_spread_callback(callback: types.CallbackQuery, state: FSMContext):
    await state.set_state(TarotReading.awaiting_custom_spread)
    await callback.message.edit_text(
        "–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –≤ –≤–∞—à–µ–º —Ä–∞—Å–∫–ª–∞–¥–µ (–æ—Ç 1 –¥–æ 15) "
        "–∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.\n\n"
        "–ü—Ä–∏–º–µ—Ä: \"3: –õ—é–±–æ–≤—å, –ö–∞—Ä—å–µ—Ä–∞, –ó–¥–æ—Ä–æ–≤—å–µ\""
    )


@dp.message(TarotReading.awaiting_custom_spread)
async def handle_custom_spread(message: types.Message, state: FSMContext):
    try:
        parts = message.text.split(":", 1)
        num_cards = int(parts[0].strip())

        if not 1 <= num_cards <= 15:
            await message.reply("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 15")
            return

        positions = [p.strip() for p in parts[1].split(",")] if len(parts) > 1 else []

        await state.update_data(
            spread_type="custom",
            custom_spread={
                "num_cards": num_cards,
                "positions": positions
            }
        )
        await state.set_state(TarotReading.awaiting_question)
        await message.answer(
            f"–ü—Ä–∏–Ω—è—Ç–æ: —Ä–∞—Å–∫–ª–∞–¥ –Ω–∞ {num_cards} –∫–∞—Ä—Ç\n\n"
            "–¢–µ–ø–µ—Ä—å —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å:"
        )
    except Exception as e:
        await message.reply("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.")


@dp.message(TarotReading.awaiting_question)
async def handle_question(message: types.Message, state: FSMContext):
    user_data = await state.get_data()
    spread_type = user_data.get("spread_type")
    question = message.text

    if spread_type == "custom":
        custom_data = user_data.get("custom_spread", {})
        num_cards = custom_data.get("num_cards", 3)
        positions = custom_data.get("positions", [])
    else:
        num_cards = {
            "spread_3": 3,
            "spread_10": 10,
            "spread_5_rel": 5
        }.get(spread_type, 3)
        positions = []

    drawn_cards = draw_random_cards(num_cards)

    cards_description = []
    for i, card in enumerate(drawn_cards):
        position_name = positions[i] if i < len(positions) else f"–ü–æ–∑–∏—Ü–∏—è {i + 1}"
        position_status = "üîª –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ" if card['position'] == '–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ' else "üî∫ –ø—Ä—è–º–æ–µ"
        cards_description.append(
            f"*{position_name}:* _{card['name']}_ ({position_status})\n"
            f"*–ó–Ω–∞—á–µ–Ω–∏–µ:* {card['meaning']}\n"
        )

    interpretation = await get_tarot_interpretation(
        spread_type=spread_type,
        question=question,
        cards=drawn_cards,
        positions=positions
    )

    response = (
        f"*üîÆ –í–∞—à —Ä–∞—Å–∫–ª–∞–¥ ({get_spread_name(spread_type)}):*\n\n" +
        "\n".join(cards_description) +
        f"\n\n*üìú –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:*\n{interpretation}"
    )

    try:
        await message.answer(
            response,
            parse_mode='Markdown',
            disable_web_page_preview=True
        )
    except Exception as e:
        print(f"Markdown error: {str(e)}")
        for i in range(0, len(response), 400):
            part = response[i:i + 400]
            await message.answer(part)

    await message.answer(
        "–•–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω —Ä–∞—Å–∫–ª–∞–¥?",
        reply_markup=get_continue_keyboard()
    )

    await state.clear()



# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
def draw_random_cards(num_cards: int) -> List[Dict]:
    cards = random.sample(TAROT_DECK, num_cards)
    for card in cards:
        card['position'] = random.choice(['–ø—Ä—è–º–æ–µ', '–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ'])
    return cards


def get_spread_name(spread_type: str) -> str:
    return {
        "spread_3": "–¢—Ä–∏ –∫–∞—Ä—Ç—ã",
        "spread_10": "–ö–µ–ª—å—Ç—Å–∫–∏–π –∫—Ä–µ—Å—Ç",
        "spread_5_rel": "–†–∞—Å–∫–ª–∞–¥ –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
        "custom": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–∞—Å–∫–ª–∞–¥"
    }.get(spread_type, "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞—Å–∫–ª–∞–¥")


async def get_tarot_interpretation(
        spread_type: str,
        question: str,
        cards: List[Dict],
        positions: Optional[List[str]] = None
) -> str:
    spread_name = get_spread_name(spread_type)
    cards_text = "\n".join(
        f"{positions[i] if i < len(positions) else f'–ü–æ–∑–∏—Ü–∏—è {i + 1}'}: "
        f"{card['name']} ({card['position']}) - {card['meaning']}"
        for i, card in enumerate(cards)
    )

    prompt = (
        f"–í–æ–ø—Ä–æ—Å: {question}\n"
        f"–¢–∏–ø —Ä–∞—Å–∫–ª–∞–¥–∞: {spread_name}\n"
        f"–í—ã–ø–∞–≤—à–∏–µ –∫–∞—Ä—Ç—ã:\n{cards_text}\n\n"
        "–î–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —ç—Ç–æ–≥–æ —Ä–∞—Å–∫–ª–∞–¥–∞ –¢–∞—Ä–æ, —É—á–∏—Ç—ã–≤–∞—è: "
        "–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞—Ä—Ç, –∏—Ö –ø–æ–ª–æ–∂–µ–Ω–∏–µ (–ø—Ä—è–º–æ–µ/–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–µ), "
        "–ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–∞—Å–∫–ª–∞–¥–µ –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏. "
        "–ë—É–¥—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º, –Ω–æ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º. "
        "–î–∞–π –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏."
    )

    headers = {
        "Content-Type": "application/json",
        "Authorization": TAROT_API_KEY,
    }

    data = {
        "model": "deepseek-ai/DeepSeek-R1-Distill-Qwen-32B",
        "messages": [
            {
                "role": "system",
                "content": "–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–∞—Ä–æ–ª–æ–≥. –î–∞–π —Ç–æ—á–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Ä–∞—Å–∫–ª–∞–¥–∞ –¢–∞—Ä–æ. –ü–∏—à–∏ –æ—Ç–≤–µ—Ç –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –∏ —Å–æ—á—É—Å—Ç–≤—É–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∏ –≤ —Ç–µ–∫—Å—Ç–µ –¥–æ–±–∞–≤–ª—è–π —ç–º–æ–¥–∑–∏ –≤ –º–µ—Ä—É.–¢–µ–∫—Å—Ç –¥–µ–ª–∞–π –∫—Ä–∞—Å–∏–≤–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–º —Å –∞–±–∑–∞—Ü–∞–º–∏. –¢—ã –±—É–¥–µ—à—å –æ—Ç–≤–µ—á–∞—Ç—å –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Telegram, –ø–æ—ç—Ç–æ–º—É —Ç–µ–±–µ –Ω–µ–ª—å–∑—è –ø—Ä–µ–≤—ã—à–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤."
            },
            {
                "role": "user",
                "content": prompt
            }
        ],
    }

    try:
        async with httpx.AsyncClient() as client:
            response = await client.post(
                TAROT_API_URL,
                headers=headers,
                json=data,
                timeout=60.0
            )
            response.raise_for_status()
            result = response.json()
            pprint(result)
            if 'choices' in result and len(result['choices']) > 0:
                text =  result['choices'][0]['message']['content']
                return text.split("</think>\n\n")[1]
            else:
                print("Unexpected API response:", result)
                return generate_fallback_interpretation(cards, positions)

    except httpx.HTTPStatusError as e:
        print(f"HTTP error: {e.response.status_code} - {e.response.text}")
    except Exception as e:
        print(f"Error: {str(e)}")

    return generate_fallback_interpretation(cards, positions)


def generate_fallback_interpretation(cards: List[Dict], positions: List[str]) -> str:
    interpretation = "üîÆ –ë–∞–∑–æ–≤–æ–µ —Ç–æ–ª–∫–æ–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ —Ä–∞—Å–∫–ª–∞–¥–∞:\n\n"

    for i, card in enumerate(cards):
        pos = positions[i] if i < len(positions) else f"–ü–æ–∑–∏—Ü–∏—è {i + 1}"
        interpretation += (
            f"{pos}: {card['name']} ({card['position']})\n"
            f"–ó–Ω–∞—á–µ–Ω–∏–µ: {card['meaning']}\n\n"
        )

    interpretation += (
        "\n–°–æ–≤–µ—Ç: –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–∞—à–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞. "
        "–ü—Ä—è–º—ã–µ –∫–∞—Ä—Ç—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —è–≤–Ω—ã–µ –≤–ª–∏—è–Ω–∏—è, –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—ã–µ - –Ω–∞ —Å–∫—Ä—ã—Ç—ã–µ –∞—Å–ø–µ–∫—Ç—ã."
    )

    return interpretation


async def main():
    await dp.start_polling(bot)


if __name__ == "__main__":
    import asyncio

    asyncio.run(main())